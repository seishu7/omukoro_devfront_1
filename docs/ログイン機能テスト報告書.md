# 酒税法リスク分析判定システム 手動テスト結果報告書

## テスト概要

- **テスト対象システム**: 酒税法リスク分析判定システム
- **テスト期間**: 202457月30日
- **テスト実施者**: [TLB福島]
- **テスト環境**: 開発環境 (localhost:3000)
- **ブラウザ**: Chrome 版 127.0.6533.119、Microsoft Edge バージョン 138.0.3351.109

## テストケース実行結果

### 1. 認証機能テスト

#### 1.1 ログイン機能

##### TC001: 正常なログイン（管理者）

**前提条件**: 
- システムが正常に起動している
- テスト用管理者アカウントが存在する

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「admin@omukoro.local」を入力
3. パスワードに「admin123」を入力
4. ログインボタンをクリック

**期待結果**: 
- ログインが成功し、メイン画面に遷移
- ヘッダーに管理者情報が表示される

**実行結果**: 
- [x] 成功

---

##### TC002: 正常なログイン（一般ユーザー）

**前提条件**: 
- システムが正常に起動している
- テスト用一般ユーザーアカウントが存在する

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「user@omukoro.local」を入力
3. パスワードに「user123」を入力
4. ログインボタンをクリック

**期待結果**: 
- ログインが成功し、メイン画面に遷移
- ヘッダーに一般ユーザー情報が表示される

**実行結果**: 
- [x] 成功

---

##### TC003: 無効なメールアドレスでのログイン

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「invalid@example.com」を入力
3. パスワードに「password123」を入力
4. ログインボタンをクリック

**期待結果**: 
- ログインが失敗する
- 「メールアドレス・パスワードのどちらかが間違っています」のエラーメッセージが表示される

**実行結果**: 
- [x] 成功

---

##### TC004: 無効なパスワードでのログイン

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「admin@omukoro.local」を入力
3. パスワードに「wrongpassword」を入力
4. ログインボタンをクリック

**期待結果**: 
- ログインが失敗する
- 「メールアドレス・パスワードのどちらかが間違っています」のエラーメッセージが表示される

**実行結果**: 
- [x] 成功

---

##### TC005: 空のフィールドでのログイン

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスフィールドを空のまま
3. パスワードフィールドを空のまま
4. ログインボタンをクリック

**期待結果**: 
- ログインボタンが無効化されている（クリックできない）

**実行結果**: 
- [x] 成功

---

#### 1.2 ログアウト機能

##### TC006: 正常なログアウト

**前提条件**: 
- ユーザーがログイン済み

**テスト手順**:
1. メイン画面でログアウトボタンをクリック
2. ログアウト処理を確認

**期待結果**: 
- ログアウトが成功し、ログイン画面に遷移
- ログアウトボタンが「ログアウト中...」と表示され、処理中はdisableされる

**実行結果**: 
- [x] 成功

---

### 2. UI/UX テスト

#### 2.1 ログイン画面

##### TC007: ログイン画面のレスポンシブデザイン

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. ブラウザのウィンドウサイズを変更（デスクトップ → タブレット → モバイル）
3. 各サイズでの表示を確認

**期待結果**: 
- 各画面サイズで適切にレイアウトが調整される
- 入力フィールドとボタンが適切に表示される

**実行結果**: 
- [x] 成功

---

##### TC008: ログインボタンの状態変化

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. フィールドが空の状態でボタンの色を確認
3. 有効な情報を入力してボタンの色を確認
4. ログインボタンをクリックして処理中の表示を確認

**期待結果**: 
- 無効時: グレー色 (#5A5552)
- 有効時: オレンジ色 (#B34700)
- 処理中: ボタンがdisableされ「ログイン中...」と表示

**実行結果**: 
- [x] 成功

---

#### 2.2 メイン画面

##### TC009: ヘッダー情報の表示

**前提条件**: 
- ユーザーがログイン済み

**テスト手順**:
1. メイン画面の表示確認
2. ヘッダー部分のユーザー情報を確認

**期待結果**: 
- ユーザーのメールアドレスが表示される
- ユーザーのロール（管理者/ユーザー）が表示される
- ログアウトボタンが表示される

**実行結果**: 
- [x] 成功

---

##### TC010: ログアウトボタンのスタイル

**前提条件**: 
- ユーザーがログイン済み

**テスト手順**:
1. ログアウトボタンの通常時の色を確認
2. ボタンにマウスホバーして色の変化を確認
3. ログアウトボタンをクリックして処理中の色を確認

**期待結果**: 
- 通常時: オレンジ色 (#B34700)
- ホバー時: 薄いオレンジ色 (#FB8F44)
- 処理中: グレー色 (#5A5552) で「ログアウト中...」表示

**実行結果**: 
- [x] 成功

---

### 3. セッション管理テスト

#### 3.1 ページリロード

##### TC011: ログイン状態でのページリロード

**前提条件**: 
- ユーザーがログイン済み

**テスト手順**:
1. メイン画面でページをリロード（F5キーまたはブラウザの更新ボタン）
2. リロード後の画面を確認

**期待結果**: 
- ログイン状態が維持されメイン画面が表示される
- ユーザー情報が正常に表示される

**実行結果**: 
- [x] 成功

---

##### TC012: ログアウト状態でのページリロード

**前提条件**: 
- ユーザーがログアウト済み

**テスト手順**:
1. ログイン画面でページをリロード
2. リロード後の画面を確認

**期待結果**: 
- 読み込み後、ログイン画面が表示される

**実行結果**: 
- [x] 成功

---

### 4. バリデーションテスト

#### 4.1 メールアドレスバリデーション

##### TC013: 無効なメールアドレス形式

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「invalid-email」を入力
3. パスワードに「password123」を入力
4. ログインボタンの状態を確認

**期待結果**: 
- メールアドレスフィールドでバリデーションエラーが表示される
- エラーメッセージ: 「正しいメールアドレスの形式で入力してください」
- メールアドレスフィールドの枠線が赤色に変化する

**実行結果**: 
- [x] 成功

---

##### TC014: パスワード要件テスト

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「test@example.com」を入力
3. パスワードに「123」（8文字未満）を入力
4. ログインボタンの状態を確認

**期待結果**: 
- パスワードフィールドでバリデーションエラーが表示される
- エラーメッセージ: 「パスワードは8文字以上で入力してください」
- パスワードフィールドの枠線が赤色に変化する

**実行結果**: 
- [x] 成功

---

##### TC015: パスワード英数字要件テスト

**前提条件**: 
- システムが正常に起動している

**テスト手順**:
1. ログイン画面にアクセス
2. メールアドレスに「test@example.com」を入力
3. パスワードに「abcdefgh」（8文字以上だが数字なし）を入力
4. ログインボタンの状態を確認

**期待結果**: 
- パスワードフィールドでバリデーションエラーが表示される
- エラーメッセージ: 「パスワードには英字と数字を含めてください」
- パスワードフィールドの枠線が赤色に変化する

**実行結果**: 
- [x] 成功

---

### 5. API連携テスト

#### 5.1 ログインAPI

##### TC016: ログインAPI正常レスポンス

**前提条件**: 
- システムが正常に起動している
- ブラウザの開発者ツールが利用可能

**テスト手順**:
1. ブラウザの開発者ツールのNetworkタブを開く
2. 正常な認証情報でログイン
3. API レスポンスを確認
4. POST /api/login のリクエストをクリック
5. ResponseタブまたはPreviewタブを確認

**期待結果**: 
- POST /api/login のステータスコードが200
- レスポンスに access_token が含まれる
- レスポンスに role 情報が含まれる

**実行結果**: 
- [x] 成功

---

#### 5.2 ユーザー情報取得API

##### TC017: ユーザー情報API正常レスポンス

**前提条件**: 
- ユーザーがログイン済み
- ブラウザの開発者ツールが利用可能

**テスト手順**:
1. ブラウザの開発者ツールのNetworkタブを開く
2. ページをリロード
3. GET /api/user/me のレスポンスを確認

**期待結果**: 
- GET /api/user/me のステータスコードが200
- レスポンスにユーザー情報（id, email, role, created_at）が含まれる

**実行結果**: 
- [x] 成功

---

### 6. ブラウザ互換性テスト

#### 6.1 Chrome ブラウザ

##### TC018: Chrome での基本機能動作

**前提条件**: 
- Chrome ブラウザ（最新版）

**テスト手順**:
1. Chrome でシステムにアクセス
2. ログイン、ログアウト機能を実行
3. レスポンシブ表示を確認

**期待結果**: 
- 全ての機能が正常に動作する

**実行結果**: 
- [x] 成功

---

#### 6.2 Edge ブラウザ

##### TC019: Edge での基本機能動作

**前提条件**: 
- Edge ブラウザ（最新版）

**テスト手順**:
1. Edge でシステムにアクセス
2. ログイン、ログアウト機能を実行
3. レスポンシブ表示を確認

**期待結果**: 
- 全ての機能が正常に動作する

**実行結果**: 
- [x] 成功

---

## テスト結果サマリー

### 実行結果統計

| カテゴリ | 総数 | 成功 | 失敗 | 成功率 |
|----------|------|------|------|--------|
| 認証機能 | 6 | - | - | - |
| UI/UX | 4 | - | - | - |
| セッション管理 | 2 | - | - | - |
| バリデーション | 3 | - | - | - |
| API連携 | 2 | - | - | - |
| ブラウザ互換性 | 2 | - | - | - |
| **合計** | **19** | **-** | **-** | **-%** |

### 発見された不具合

#### 重要度: 高

**[Bug-001] ログイン中のリロード操作**
- **現象**: [ログイン中にリロード操作をするとログイン画面が一瞬表示される]
- **再現手順**: [ログインした状態でブラウザのリロードボタンを押す]
- **期待結果**: [読み込まれるがそのまま判定システムの画面を維持]
- **実際の結果**: [一瞬だけログイン画面がちらつく]
- **優先度**: 高
- **状況**: 修正済
- **修正内容**: [ログインボタン押下時にローディング表示を削除し、ボタンをdisable状態に変更]

**[Bug-002] Next.js Hydrationエラー**
- **現象**: [SRとクライアント間の状態不一致によるHydrationエラー]
- **再現手順**: [ログイン画面を起動し、有効な認証情報でログイン後にブラウザの開発者コンソールを確認]
- **期待結果**: [スムーズにページがリロードされる、ログイン状態が維持されたまま画面表示、エラー表示なし]
- **実際の結果**: [RecoverableErrorの表示]
- **原因**: [SSR（サーバーサイドレンダリング）とクライアントサイドの初期状態が異なる]
- **優先度**: 高
- **状況**: 修正済
- **修正内容**: [isInitialized状態を追加、ユーザー情報キャッシュ機能を実装してリロード時の体験向上]

### 改善提案

1. **[提案-001] セキュリティ強化**
   - **概要**: [操作ログDB構造の見直し]
   - **理由**: [操作ログDBでのセキュリティ強化、法的要件対応、運用・保守の利便性向上]
   - **提案内容**: [誰が：user_id + usersテーブルとの結合でユーザー特定、いつ：timestampで正確な時刻記録、何を：actionでログイン/ログアウト/情報取得等を記録、どこから：ip_addressでアクセス元を追跡可能にする※詳しくはgithubコメントをご確認ください]

### テスト環境詳細

- **OS**: [macbook air]
- **ブラウザ**: 
  - Chrome 127.0.6533.119
  - Microsoft Edge バージョン 138.0.3351.109
- **画面解像度**: 1920x1080, 1366x768, 375x667 (モバイル)
- **ネットワーク**: 有線LAN/Wi-Fi
- **データベース**: MySQL 8.0

---

**テスト実施日**: 2025年7月30日  
**テスト実施者**: [TLB福島]  
**文書バージョン**: 1.0